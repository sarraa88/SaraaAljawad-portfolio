---
title: "Data Analysis intro"
format: html
---

## Introduction

In this exercise we will use the `gapminder` dataset from the `dslabs` package

## Required Packages

This exercise uses the following packages:

\- **dslabs**: provides the `gapminder` dataset

\- **dplyr**: data wrangling (filter/select)

\- **ggplot2**: plotting

\- **broom**: tidy outputs from linear models

**Load all packages at the top of the analysis so they are available later.**

**Each library () call attaches one package.**

library(dslabs) \# provides the gapminder dataset

library(dplyr) \# used for filtering/selecting columns

library(ggplot2) \# used for plotting

library(broom) \# used to tidy lm() results

## Loading and Checking the data

```{r}
# load dslabs package
library("dslabs")
```

```{r}

# help(gapminder)  
# get an overview of data structure
str(gapminder)
```

```{r}
# get a summary of data
summary(gapminder)
```

```{r}
# determine the type of object gapminder is
class(gapminder)
```

## Processing data

```{r}
# Create a new object that keeps ONLY rows where continent == "Africa"
# (this subsets the original gapminder data frame)
africadata <- gapminder[gapminder$continent == "Africa", ]

# Check the structure of the new Africa-only dataset
str(africadata)

```

```{r}
# Get summary statistics for the Africa-only dataset
summary(africadata)
```

```{r}
library(dplyr)

```

```{r}
# Infant mortality vs life expectancy

africa_im_le <- africadata %>%
select(infant_mortality, life_expectancy)

str(africa_im_le)
summary(africa_im_le)

# Population vs life expectancy

africa_pop_le <- africadata %>%
select(population, life_expectancy)

str(africa_pop_le)
summary(africa_pop_le)

```

# Plotting

Making plots for each of the new subsets.

```{r}
# load ggplot2 here since we will make plots

library(ggplot2)

```

```{r}
# Plot life expectancy as a function of infant mortality

ggplot(africa_im_le, aes(x = infant_mortality, y = life_expectancy)) +
geom_point()

```

```{r}
# Plot life expectancy as a function of population size (log scale)

ggplot(africa_pop_le, aes(x = population, y = life_expectancy)) +
geom_point() +
scale_x_log10()

```

# More data processing

To understand which years have missing infant mortality data, we first check which years contain NA values for infant_mortality. Then we select a year with complete data.

```{r}
# Find rows with missing infant mortality

africa_na <- africadata %>%
filter(is.na(infant_mortality))

# Check which years have missing values

table(africa_na$year)

```

```{r}
# Keep only data from the year 2000

africa_2000 <- africadata %>%
filter(year == 2000)

# Check structure and summary

str(africa_2000)
summary(africa_2000)

```

# More Plotting

We now repeat the same plots as before, but only using data from the year 2000.

```{r}

# Create 2000-only versions of the two 2-column datasets 

africa2000_im_le <- africa_2000 %>%
  select(infant_mortality, life_expectancy)


str(africa2000_im_le)

#summary of infant mortality and life expectancy data in 2000
summary(africa2000_im_le)

africa2000_pop_le <- africa_2000 %>%
  select(population, life_expectancy)

str(africa2000_pop_le)

#summary of population and life expectancy data in 2000
summary(africa2000_pop_le)

ggplot(africa_2000, aes(x = infant_mortality, y = life_expectancy)) +
geom_point()

ggplot(africa_2000, aes(x = population, y = life_expectancy)) +
geom_point() +
scale_x_log10()

```

# A simple fit

We fit linear regression models using life expectancy as the response variable and infant mortality and population size as separate predictors, based on the Africa-only data from the year 2000.

```{r}
# Fit 1: linear model with life expectancy as outcome and infant mortality as predictor (year 2000 only)

fit1 <- lm(life_expectancy ~ infant_mortality, data = africa_2000)

# Show model results

summary(fit1)



# Fit 2: linear model with life expectancy as outcome and population as predictor (year 2000 only)

fit2 <- lm(life_expectancy ~ population, data = africa_2000)

# Show model results

summary(fit2)

```

# This section contribution by Austin_Hill

```{r}
#Load in dslabs
library(dslabs)
```

```{r}
#look at data 
str(death_prob)
summary(death_prob)
```

```{r}
#Type of class the data is
class(death_prob)
```

```{r}
# add dplyr package 
library(dplyr)
```

```{r}
# Filter data to only females of the age of 16 +
femaledata16 <- death_prob %>%
  filter(sex == "Female", age >= 16)
# look at femaledata
str(femaledata16)
summary(femaledata16)
```

```{r}
# add ggplot
library(ggplot2)
```

```{r}
# plotting 16+ girls probability of death in the next year in the USA in 2015
ggplot(femaledata16, aes(x = age, y = prob)) +
  geom_line() +
  geom_point() +
  labs(
    title = "Probability of death vs Age (Females)",
    x = "Age",
    y = "Probability"
  ) +
  theme_minimal()
```

```{r}
# Filter data to only males of the age of 16 +
maledata16 <- death_prob %>%
  filter(sex == "Male", age >= 16)
# look at femaledata
str(maledata16)
summary(maledata16)
```

```{r}
# plotting 16+ males probability of death in the next year in the USA in 2015
ggplot(maledata16, aes(x = age, y = prob)) +
  geom_line() +
  geom_point() +
  labs(
    title = "Probability of death vs Age (Males)",
    x = "Age",
    y = "Probability"
  ) +
  theme_minimal()
```

```{r}
# Compare females and males 16+ for significant differnces in the data combined
combined <- rbind(femaledata16, maledata16)

model1 <- lm(prob ~ age + sex, data = combined)
summary(model1)
```

# [**The Age effect**]{.underline}

# age: Estimate = 0.0062232, p \< 2e-16 \*\*\*

# Highly significant.

# For each additional year of age, the probability increases by \~0.0062 on average.

# This matches mortality expectations: older individuals have higher 1-year death risk.

# [**Sex effect**]{.underline}

# sexMale: Estimate = 0.0133138, p = 0.497

# Not significant (p â‰ˆ 0.5).

# This means no evidence of a meaningful difference in overall mortality level between males and females in your sample once age is controlled for.So, in this model: Females and males appear similar in mortality probability after accounting for age.